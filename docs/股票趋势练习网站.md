# 股票趋势练习网站需求文档

## 📋 项目概述
**项目名称**：股票趋势练习网站 
**核心功能**：以特定日期为分界点，分别展示股票的历史走势和未来走势

## 🎯 核心功能需求

### 1. 股票选择与时间分界点设置
- **股票代码/名称输入**：支持输入股票代码或股票名称，提供自动补全功能
- **自动补全格式**：按"股票代码[股票名称]"格式显示，如"000001[平安银行]"
- **日期选择器**：精确到日的分界点设置，支持手动输入
- **数据验证**：验证股票代码有效性和日期合理性
- **历史数据范围设置**：允许用户自定义历史走势显示的时间范围（如最近3个月、6个月、1年）
- **全量数据获取**：用户输入股票代码和分界点日期后，系统自动下载该股票上市以来的全部历史数据

### 2. 用户交互流程与数据展示
- **自动刷新机制**：用户输入股票代码或股票名称并确定特定日期后，系统自动刷新股票的历史走势图和未来走势图
- **默认显示模式**：历史走势默认显示分界点前100天的数据，未来走势默认显示分界点后100天的数据
- **复盘场景模拟**：通过下载上市以来全部数据并按日期切分，模拟用户在特定时刻进行股票分析的场景
- **历史/未来切换**：提供直观的切换控件（标签页或按钮），允许用户在历史走势和未来走势之间无缝切换
- **对比分析模式**：支持分屏或叠加显示历史与未来走势，便于用户发现趋势关系和模式
- **数据加载状态**：提供友好的加载提示和错误处理机制

### 3. 可复用图表组件系统
- **通用图表核心**：设计可复用的图表组件，支持历史和未来数据的统一展示
- **数据适配层**：通过适配器模式处理历史数据和未来数据的格式转换
- **配置驱动**：图表显示参数（时间范围、技术指标、颜色方案）通过配置对象动态控制
- **组件参数化**：核心图表组件接收数据源和显示参数，自动渲染相应图表

### 4. 历史走势图表（分界点前）
- **K线图展示**：显示选定日期前的历史价格走势，支持MA、MACD等指标叠加
- **时间周期选择**：支持日线、周线、月线切换
- **成交量副图**：配合显示交易量变化，叠加MAVOL5、MAVOL10、MAVOL100移动成交量指标
- **KDJ副图**：配合显示KDJ变化，包含K线、D线、J线
- **时间轴缩放**：支持图表时间范围调整
- **交互功能**：鼠标悬停显示详细数据点
- **分界点标记**：在图表上明确标记时间分界点位置

### 5. 未来走势图表（分界点后）
- **复用K线图功能**：复用历史走势图表的K线图展示功能
- **技术指标**：支持MA、MACD等指标叠加
- **预测区间**：显示可能的波动范围
- **关键标记**：标记重要价格水平
- **置信度显示**：对未来走势预测提供置信度指标
- **多方案对比**：支持多种预测方案的对比展示

## 🛠️ 技术方案

### 前端技术栈
- **框架**：React 18 + TypeScript
- **UI组件**：shadcn/ui（基于Tailwind CSS）
- **图表库**：Recharts（专业的图表可视化）
- **构建工具**：Vite

### 数据源与缓存策略
- **股票API**：使用AKShare开源金融数据接口库
- **数据获取**：Python后端服务通过AKShare获取A股实时和历史数据
- **数据格式**：JSON REST API
- **全量数据获取**：用户完成数据输入后，查询股票从上市到目前的全部数据，并做好缓存
- **数据切分**：按用户选择的日期切分成历史走势和未来走势
- **技术指标计算**：MA5, MA10, MA20, MA60, MAVOL5, MAVOL10, MAVOL100, KDJ等由后台进行计算，不通过API获取
- **缓存机制**：Redis缓存减少数据请求，提升响应速度
- **数据特性**：支持A股、港股、美股、期货、基金等多种金融数据

## 🎨 设计风格
- **主题**：深色主题，科技金融风格
- **配色**：蓝色调科技感配色
- **布局**：左侧控制面板，右侧图表展示区（支持横向页签切换）
- **交互**：玻璃态卡片设计，响应式布局，横向页签切换

## 📈 K线图区域技术指标展示设计（参考同花顺等专业股票软件）

### 1. K线图整体布局结构

#### 主图区域（K线图）
- **布局比例**：占据图表区域约60%的高度
- **K线显示**：传统蜡烛图（红涨绿跌）
  - 阳线（上涨）：空心红色/白色，上影线和下影线为实线
  - 阴线（下跌）：实心绿色/黑色，上影线和下影线为实线
- **移动平均线叠加（可配置开关）**：
  - MA5：白色线（可配置显示开关）
  - MA10：黄色线（可配置显示开关）
  - MA20：紫色线（可配置显示开关）
  - MA60：浅蓝色线（可配置显示开关）
- **网格系统**：浅灰色虚线网格，不干扰K线主体显示
- **坐标轴**：
  - 左侧价格轴：根据显示数据的最大最小值动态调整价格范围
  - 右侧百分比轴：显示股价相对显示数据中第一条数据的涨幅百分比
  - 底部时间轴：显示交易日期
- **缩放功能**：支持滚轮进行放大和缩小，历史走势默认显示前100天数据，未来走势默认显示后100天数据，用户通过滚轮动态调整走势图的显示范围

#### 副图区域（技术指标）
- **布局比例**：占据图表区域约40%的高度，分为多个可配置副图
- **可堆叠设计**：支持技术指标的动态添加/删除和顺序调整
- **副图分隔线**：浅灰色实线分隔各副图区域
- **每个副图高度**：默认80-100px，可根据显示内容动态调整

### 2. 成交量副图（VOL）设计规范

#### 基础显示
- **柱状图样式**：
  - 上涨日：红色空心柱（外框红色，内部透明）
  - 下跌日：绿色实心柱
  - 平盘日：灰色柱
- **移动成交量指标叠加（可配置开关）**：
  - MAVOL5：白色线（5日成交量移动平均，可配置显示开关）
  - MAVOL10：黄色线（10日成交量移动平均，可配置显示开关）
  - MAVOL100：浅蓝色线（100日成交量移动平均，可配置显示开关）
- **Y轴标注**：显示成交量值，采用科学计数法（如10万、100万、1000万）
- **标签**：左上角显示"VOL"标识，右上角可显示当前成交量数值

#### 交互功能
- **数据提示**：鼠标悬停显示日期、成交量、MAVOL值
- **单击高亮**：点击某日成交量柱，对应K线图同日期高亮显示

### 3. KDJ副图设计规范

#### 曲线显示
- **K线**：白色实线，表示快速确认线
- **D线**：黄色实线，表示慢速主干线
- **J线**：紫色实线，表示乖离线
- **超买/超卖区域标识**：
  - 超买区（80以上）：浅红色背景填充区域
  - 超卖区（20以下）：浅绿色背景填充区域
  - 中性区（20-80）：无填充

#### 数值范围
- **Y轴范围**：0-100固定范围
- **刻度线**：20、50、80三个关键刻度线
- **标签**：左上角显示"KDJ(9,3,3)"标识，右上角显示最新K、D、J值

#### 信号标记
- **金叉标记**：K线从下向上穿过D线，显示金色小圆点
- **死叉标记**：K线从上向下穿过D线，显示蓝色小圆点

### 4. MACD副图设计规范

#### 基础显示
- **DIFF线**：白色实线，表示短期与长期EMA差值
- **DEA线**：黄色实线，表示DIFF线的平滑移动平均
- **MACD柱状图**：
  - 正值（金叉）：红色空心柱
  - 负值（死叉）：绿色实心柱
  - 零轴线：浅灰色虚线

#### 数值范围
- **Y轴**：动态范围，根据MACD值自动调整
- **缩放比例**：保持MACD柱状图显示清晰
- **标签**：左上角显示"MACD(12,26,9)"标识，右上角显示最新DIFF、DEA、MACD值

#### 信号增强
- **零轴穿越标记**：
  - 上穿零轴：显示向上三角形标记
  - 下穿零轴：显示向下三角形标记
- **柱状图变色**：连续增加/减少时柱状图颜色加深

### 5. 图表交互控件设计

#### 顶部工具栏
- **时间周期切换**：分时、日线、周线、月线切换按钮
- **技术指标选择**：下拉菜单或图标按钮，添加/删除副图指标
- **绘图工具**：趋势线、支撑/压力线、矩形、圆形等绘图工具
- **全屏/恢复**：全屏显示图表或恢复原始布局

#### 右键菜单
- **指标参数设置**：点击指标可调整参数（如KDJ的9,3,3周期）
- **删除指标**：从图表中移除指定技术指标
- **添加指标**：从指标库添加新的技术指标
- **样式设置**：调整指标线颜色、粗细等视觉样式

#### 缩放与平移
- **鼠标滚轮缩放**：滚动鼠标滚轮放大/缩小时间轴，不要一次显示所有历史走势或未来走势；默认显示100天，用户通过滚轮放大和缩小调整显示的数据窗口大小
- **拖拽平移**：按住鼠标左键拖动图表查看不同时间段
- **双击重置**：双击图表恢复默认显示范围
- **十字光标**：按住Ctrl键显示精确的十字光标，便于精确读数

### 6. 数据联动与同步机制

#### 多图联动
- **时间轴同步**：主图与副图的时间轴完全同步
- **数据点联动**：鼠标悬停在某一图表时，所有图表同一日期数据点同步高亮
- **分界点标记**：历史和未来图表中的分界点位置同步标记

#### 历史与未来切换
- **平滑过渡**：历史与未来图表切换时采用淡入淡出效果
- **数据保持**：切换时保持相同的时间范围和缩放比例
- **指标连续**：确保技术指标在切换时保持计算连续性

## 💡 用户体验增强

### 1. 交互设计
- **流畅切换动画**：历史/未来走势切换时采用平滑过渡动画
- **数据联动高亮**：分界点在历史和未来图表中同步高亮显示
- **手势操作支持**：支持移动端触摸滑动、缩放等手势操作
- **键盘快捷键**：提供常用操作的键盘快捷键支持

### 2. 数据可视化增强
- **趋势线自动绘制**：基于历史数据自动识别并绘制支撑线和压力线
- **关键事件标记**：在图表中标记重要市场事件（如财报发布、政策变动等）
- **多时间维度对比**：支持同一股票不同时间段的对比分析
- **关联性提示**：智能提示历史模式与未来走势的可能关联性

## 🔧 技术实现细节

### 1. 图表复用架构
```typescript
// 通用图表接口设计
interface ChartData {
  date: string;
  open: number;
  close: number;
  high: number;
  low: number;
  volume: number;
  // 技术指标数据
  ma5?: number;
  ma10?: number;
  ma20?: number;
  ma60?: number;
  mavol5?: number;
  mavol10?: number;
  mavol100?: number;
  kdj?: { k: number; d: number; j: number };
  macd?: {
    diff?: number;
    dea?: number;
    macd?: number;
  };
}

// 技术指标配置接口
interface IndicatorConfig {
  ma5: boolean;
  ma10: boolean;
  ma20: boolean;
  ma60: boolean;
  mavol5: boolean;
  mavol10: boolean;
  mavol100: boolean;
  kdj: boolean;
  macd: boolean;
}

// 图表组件属性
interface StockChartProps {
  data: ChartData[];
  indicatorConfig: IndicatorConfig; // 技术指标显示配置
  timeRange: { start: string; end: string };
  type: 'historical' | 'future';
  onTimePointSelect?: (date: string) => void;
  zoomLevel: number; // 缩放级别，控制显示天数
}
```

### 2. 数据管理策略
- **状态管理**：使用React Context或Redux管理全局股票数据和用户设置
- **全量数据缓存**：用户完成数据输入后，查询股票从上市到目前的全部数据并进行缓存，避免重复请求
- **技术指标缓存**：MA5, MA10, MA20, MA60, MAVOL5, MAVOL10, MAVOL100, KDJ等计算结果进行缓存，提高响应速度
- **数据切分策略**：按用户选择的日期将全量数据切分成历史走势和未来走势
- **本地缓存**：利用浏览器本地存储缓存常用股票数据，减少网络请求
- **增量更新**：对于实时数据，采用增量更新策略降低数据传输量
- **错误重试**：实现智能重试机制，处理网络不稳定情况

### 3. 性能优化
- **图表渲染优化**：大数据量时采用数据采样和虚拟化技术
- **组件懒加载**：非首屏组件采用懒加载策略
- **预加载机制**：用户输入时智能预加载可能需要的股票数据
- **响应式设计**：适配不同屏幕尺寸，特别是移动端优化

## 📊 开发计划（6个阶段）

### 阶段1：基础架构搭建
- 实现基础项目结构和主页面布局框架
- 搭建组件系统基础架构，设计可复用的图表组件接口
- 实现基础状态管理机制
- 配置开发和构建环境

### 阶段2：控制面板开发
- 开发股票代码/名称输入和自动补全功能（按"股票代码[股票名称]"格式显示）
- 实现日期选择器和历史数据范围设置
- 添加技术指标显示开关配置（MA5, MA10, MA20, MA60, MAVOL5, MAVOL10, MAVOL100）
- 添加数据验证和错误处理机制
- 实现用户偏好设置的本地存储

### 阶段3：数据服务集成
- 集成AKShare股票API数据获取服务
- 实现Python后端API接口和数据处理逻辑
- 实现股票从上市到目前全量数据的获取和缓存机制
- 实现技术指标计算服务（MA5, MA10, MA20, MA60, MAVOL5, MAVOL10, MAVOL100, KDJ等）
- 实现按用户选择日期切分历史数据和未来数据的逻辑
- 添加数据缓存和性能优化机制
- 实现数据适配层，统一历史和未来数据格式

### 阶段4：通用图表组件开发
- 实现可复用的K线图核心组件
- 开发技术指标显示功能（MA5, MA10, MA20, MA60, MAVOL5, MAVOL10, MAVOL100, KDJ等）
- 实现技术指标显示开关配置功能
- 实现图表缩放功能（历史走势默认显示前100天，未来走势默认显示后100天，通过滚轮动态调整显示范围）
- 实现坐标轴动态调整功能（左侧价格轴根据数据范围调整，右侧显示相对涨幅）
- 实现图表交互功能（缩放、悬停提示、数据点选择）
- 添加图表主题和样式配置系统

### 阶段5：历史走势功能实现
- 实现历史走势图表的数据展示
- 添加成交量副图和指标叠加功能
- 实现时间轴调整和周期切换功能
- 添加分界点标记和关键事件显示

### 阶段6：未来走势与交互优化
- 实现未来走势图表展示功能
- 开发历史/未来走势切换机制和动画效果
- 实现对比分析模式和趋势预测显示
- 优化用户体验，添加手势操作和键盘快捷键支持

## 🆕 新增需求详解

### 1. 股票自动补全功能

#### 输入格式与显示
- **输入方式**：支持股票代码或股票名称的模糊搜索
- **显示格式**：自动补全结果按"股票代码[股票名称]"格式显示
- **示例**：
  - 输入"平安" → 显示"000001[平安银行]"
  - 输入"0000" → 显示"000001[平安银行]"、"000002[万科A]"等选项

#### 实现策略
- **数据源**：维护股票代码和名称的映射表，支持实时搜索
- **缓存机制**：本地缓存股票映射表，提高响应速度
- **智能匹配**：支持拼音、简称等多种匹配方式

### 2. 技术指标配置开关

#### 股价走势图指标配置
```typescript
// 股价走势图技术指标配置
interface PriceIndicatorConfig {
  ma5: boolean;    // 5日移动平均线开关
  ma10: boolean;   // 10日移动平均线开关
  ma20: boolean;   // 20日移动平均线开关
  ma60: boolean;   // 60日移动平均线开关
}
```

#### 成交量副图指标配置
```typescript
// 成交量副图技术指标配置
interface VolumeIndicatorConfig {
  mavol5: boolean;   // 5日成交量移动平均线开关
  mavol10: boolean;  // 10日成交量移动平均线开关
  mavol100: boolean; // 100日成交量移动平均线开关
}
```

#### 用户界面实现
- **配置面板**：在控制面板区域添加技术指标配置区域
- **开关控件**：使用复选框或开关组件控制各指标的显示/隐藏
- **即时生效**：配置更改后图表立即更新，无需刷新

### 3. 数据获取与缓存策略

#### 全量数据获取流程
1. **用户输入完成**：股票代码和分界点日期确定后触发
2. **全量数据下载**：从后端API下载该股票上市以来的全部历史数据
3. **数据缓存**：将全量数据存储在本地缓存中，标记股票代码和缓存时间
4. **数据切分**：根据用户选择的分界点日期，将数据切分为历史走势和未来走势两部分，用于复盘场景模拟
5. **默认显示**：历史走势默认显示前100天数据，未来走势默认显示后100天数据

#### 技术指标计算与缓存
- **计算服务**：后端提供技术指标计算API
- **缓存策略**：计算结果与原始数据关联缓存，避免重复计算
- **数据结构**：技术指标数据与原始K线数据合并存储

#### 缓存管理机制
```typescript
// 缓存管理接口
interface StockDataCache {
  stockCode: string;        // 股票代码
  data: ChartData[];        // 全量K线数据（含技术指标）
  fetchTime: number;        // 数据获取时间戳
  expireTime: number;       // 缓存过期时间
}
```

### 4. 图表缩放与坐标轴调整

#### 缩放功能实现
- **默认显示**：历史走势默认显示分界点前100天的数据，未来走势默认显示分界点后100天的数据
- **缩放控制**：支持鼠标滚轮进行放大和缩小操作，动态调整走势图的显示范围
- **数据窗口**：缩放时调整显示的数据窗口大小，最小10天，最大全部数据
- **性能优化**：大数据量时采用数据采样，确保缩放操作流畅

#### 坐标轴动态调整
- **左侧价格轴**：根据当前显示数据的最大最小值自动调整价格范围
- **右侧百分比轴**：显示当前价格相对于显示数据中第一条数据的涨跌百分比
- **零点定位**：百分比轴以第一条数据为0%基准点
- **刻度标注**：自动计算合理的刻度间隔，避免标注过于密集

#### 实现示例
```typescript
// 坐标轴计算逻辑
function calculateAxisRange(data: ChartData[]) {
  if (!data || data.length === 0) return { min: 0, max: 100 };
  
  const prices = data.flatMap(d => [d.open, d.close, d.high, d.low]);
  const minPrice = Math.min(...prices);
  const maxPrice = Math.max(...prices);
  
  // 添加5%的上下边距，确保K线完整显示
  const padding = (maxPrice - minPrice) * 0.05;
  
  return {
    min: minPrice - padding,
    max: maxPrice + padding
  };
}

// 百分比轴计算
function calculatePercentageAxis(data: ChartData[]) {
  if (!data || data.length === 0) return [];
  
  const basePrice = data[0].close; // 以第一条数据为基准
  const percentages = data.map(d => ({
    date: d.date,
    percentage: ((d.close - basePrice) / basePrice) * 100
  }));
  
  return percentages;
}
```

### 5. 交互体验优化

#### 平滑缩放体验
- **缩放步长**：合理的缩放步长设计，确保缩放体验平滑
- **动画过渡**：缩放操作时添加平滑的动画过渡效果
- **中心点保持**：缩放时尽量保持当前视图的中心点位置

#### 数据加载优化
- **增量加载**：切分数据后按需加载历史或未来数据
- **预加载机制**：根据用户行为预测可能需要的数据段并预加载
- **加载状态**：清晰的加载进度提示，提升用户体验

---

**文档创建时间**：2025-12-09  
**最后更新时间**：2025-12-14
**项目状态**：需求分析完成，待开发确认