# 部署说明 - CloudBase云托管（开发环境）

## 🎯 部署策略

**核心规则：CloudBase采用单一开发环境部署策略，简化配置和维护复杂度**

**版本变更记录：**
- **v2.1 (2025-12-14)**: 调整为单一开发环境配置，移除多环境复杂度
- **v2.0**: 初始版本，支持多环境部署

## 📦 部署架构

### 单一开发环境部署方案

| 部署方式 | 适用场景 | 技术栈 | 配置文件 | 部署命令 |
|---------|---------|--------|----------|----------|
| **CloudBase开发环境** | 团队协作开发 | FastAPI + Python + Docker | cloudbaserc.json | tcb framework deploy |
| 本地Docker部署 | 个人开发测试 | FastAPI + Python + Docker | docker-compose.yml | docker-compose up |

**架构变更说明：**
- 移除生产环境配置，统一使用开发环境
- 简化配置文件管理，统一使用 `cloudbaserc.json`
- 优化资源配置，更适合开发调试需求

## 🚀 CloudBase开发环境部署

### 开发环境配置

**基本信息**
- **服务名称**: `stockstudy-backend-dev`
- **环境ID**: `stockstudy-dev-7gg0qgesca10330c`
- **访问地址**: `https://stockstudy-backend-dev-{id}.sh.run.tcloudbase.com`
- **服务类型**: 容器型云托管
- **配置文件**: `cloudbaserc.json`
- **配置版本**: v2.1 (2025-12-14)

**技术规格**
- **运行时**: Python 3.8+ (基于Dockerfile)
- **CPU**: 0.25核
- **内存**: 0.5GB
- **实例数**: 最小1个，最大2个
- **端口**: 8000

**开发环境特性**
- **调试模式**: 启用DEBUG模式，便于问题排查
- **缓存时间**: 1800秒，适合开发调试需求
- **内存配置**: 256MB，优化开发资源使用
- **环境变量**: 包含开发专用配置，支持调试功能

**访问配置**
- **访问类型**: 公网访问 (PUBLIC)
- **内网访问**: 关闭
- **健康检查**: 支持自动健康检查

**自动扩缩容**
- **策略类型**: 基于CPU使用率
- **阈值**: 60%
- **扩缩容模式**: 自动

### API接口

**健康检查**
```
GET /api/health
```

**股票数据接口**
```
GET /api/stock/{symbol}
参数: 
  - dividing_date: 分界日期 (YYYY-MM-DD)
  - historical_days: 历史天数
  - future_days: 未来天数
```

**股票搜索接口**
```
GET /api/stock/search
参数:
  - query: 搜索关键词
```

## 🔧 开发环境部署流程

### 首次部署

1. **环境准备**
   ```bash
   # 创建CloudBase开发环境（首次部署）
   # 环境ID: stockstudy-dev-7gg0qgesca10330c
   ```

2. **后端部署**
   ```bash
   # 使用CloudBase云托管部署开发环境
   tcb framework deploy
   ```

3. **验证部署**
   ```bash
   # 测试开发环境健康检查接口
   curl https://stockstudy-backend-dev-{id}.sh.run.tcloudbase.com/api/health
   ```

### 更新部署

1. **代码更新后重新部署**
   ```bash
   # 代码更新后重新部署开发环境
   tcb framework deploy
   ```

2. **版本管理**
   - 支持版本回滚
   - 自动流量切换
   - 简化部署流程，无需环境切换

**部署流程变更说明：**
- 移除多环境部署复杂度，统一使用单一开发环境
- 简化部署命令，无需配置文件参数
- 优化验证流程，专注于开发环境功能测试

## 📊 监控和日志

### 监控指标
- CPU使用率
- 内存使用率
- 请求量
- 错误率
- 响应时间

### 日志查看
- 通过CloudBase控制台查看服务日志
- 支持按时间范围筛选
- 实时日志流

## 🔒 安全配置

### 网络访问控制
- 支持IP白名单
- HTTPS强制加密
- DDoS防护

### 数据安全
- 数据加密传输
- 访问权限控制
- 自动备份

## 💡 最佳实践

### 部署优化
1. **资源规划**: 根据实际负载调整CPU和内存规格
2. **健康检查**: 确保应用提供有效的健康检查接口
3. **环境变量**: 敏感配置通过环境变量管理
4. **日志规范**: 统一的日志格式和级别

### 故障排查
1. **服务不可用**: 检查健康检查接口是否正常
2. **性能问题**: 监控CPU和内存使用率
3. **网络问题**: 检查安全组和网络配置

## 📞 支持和维护

### 技术支持
- CloudBase官方文档
- 腾讯云技术支持
- 项目Issue反馈

### 维护计划
- 定期监控服务状态
- 及时更新依赖版本
- 备份重要配置

---

## 🔄 最新部署记录 (2025-12-15)

### 前端独立部署

#### 部署信息
- **部署时间**: 2025-12-15 19:50:12
- **部署类型**: 前端独立部署 (静态网站托管)
- **部署人员**: AI助手 (自动部署)
- **部署状态**: ✅ 成功
- **部署环境**: CloudBase静态网站托管

#### 技术详情
- **前端版本**: v2.1.1
- **构建工具**: Vite 6.3.5
- **框架版本**: React 18.3.1 + TypeScript
- **部署文件**: 3个文件 (645.3KB)
- **访问地址**: https://stockstudy-7gg0qgesca10330c-1251378228.tcloudbaseapp.com/

#### 服务器配置
- **环境ID**: stockstudy-7gg0qgesca10330c
- **部署区域**: 上海 (ap-shanghai)
- **存储桶**: 5710-static-stockstudy-7gg0qgesca10330c-1251378228
- **CDN域名**: stockstudy-7gg0qgesca10330c-1251378228.tcloudbaseapp.com
- **安全配置**: HTTPS强制加密，DDoS防护

#### 环境变量设置
- **API地址**: 生产环境API已配置
- **调试模式**: 生产环境优化
- **缓存时间**: CDN自动缓存策略

### 部署说明
- 本次部署仅包含前端静态资源，后端服务保持原有状态
- 前端应用已完全独立，可直接访问使用
- CDN缓存预计需要几分钟完成全球分发

---

**最后更新**: 2025-12-15 (部署记录)  
**部署状态**: ✅ 前端已上线，后端待部署  
**维护人员**: AI助手 (自动部署)