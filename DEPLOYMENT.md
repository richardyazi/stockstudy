# 部署说明 - CloudBase云托管

## 🎯 部署策略

**核心规则：CloudBase默认采用FastAPI+云托管的方式部署后端服务**

## 📦 部署架构

### 后端部署方案

| 部署方式 | 适用场景 | 技术栈 | 优势 |
|---------|---------|--------|------|
| **CloudBase云托管（默认）** | 生产环境 | FastAPI + Python + Docker | 自动扩缩容、高可用、按量付费 |
| 本地Docker部署 | 开发测试 | FastAPI + Python + Docker | 本地开发调试 |
| 云函数部署 | 备选方案 | Node.js + Express | 轻量级、快速部署 |

## 🚀 CloudBase云托管部署

### 服务配置

**基本信息**
- **服务名称**: `stockstudy-backend`
- **环境ID**: `stockstudy-7gg0qgesca10330c`
- **访问地址**: `https://stockstudy-backend-207775-4-1251378228.sh.run.tcloudbase.com`
- **服务类型**: 容器型云托管

**技术规格**
- **运行时**: Python 3.8+ (基于Dockerfile)
- **CPU**: 0.25核
- **内存**: 0.5GB
- **实例数**: 最小1个，最大2个
- **端口**: 8000

**访问配置**
- **访问类型**: 公网访问 (PUBLIC)
- **内网访问**: 关闭
- **健康检查**: 支持自动健康检查

**自动扩缩容**
- **策略类型**: 基于CPU使用率
- **阈值**: 60%
- **扩缩容模式**: 自动

### API接口

**健康检查**
```
GET /api/health
```

**股票数据接口**
```
GET /api/stock/{symbol}
参数: 
  - dividing_date: 分界日期 (YYYY-MM-DD)
  - historical_days: 历史天数
  - future_days: 未来天数
```

**股票搜索接口**
```
GET /api/stock/search
参数:
  - query: 搜索关键词
```

## 🔧 部署流程

### 首次部署

1. **环境准备**
   ```bash
   # 确保CloudBase环境已创建
   # 环境ID: stockstudy-7gg0qgesca10330c
   ```

2. **后端部署**
   ```bash
   # 使用CloudBase云托管部署
   # 服务将自动构建并部署到云端
   ```

3. **验证部署**
   ```bash
   # 测试健康检查接口
   curl https://stockstudy-backend-207775-4-1251378228.sh.run.tcloudbase.com/api/health
   ```

### 更新部署

1. **代码更新后重新部署**
   ```bash
   # CloudBase会自动检测代码变更
   # 重新构建并部署新版本
   ```

2. **版本管理**
   - 每个部署都会创建新版本
   - 支持版本回滚
   - 自动流量切换

## 📊 监控和日志

### 监控指标
- CPU使用率
- 内存使用率
- 请求量
- 错误率
- 响应时间

### 日志查看
- 通过CloudBase控制台查看服务日志
- 支持按时间范围筛选
- 实时日志流

## 🔒 安全配置

### 网络访问控制
- 支持IP白名单
- HTTPS强制加密
- DDoS防护

### 数据安全
- 数据加密传输
- 访问权限控制
- 自动备份

## 💡 最佳实践

### 部署优化
1. **资源规划**: 根据实际负载调整CPU和内存规格
2. **健康检查**: 确保应用提供有效的健康检查接口
3. **环境变量**: 敏感配置通过环境变量管理
4. **日志规范**: 统一的日志格式和级别

### 故障排查
1. **服务不可用**: 检查健康检查接口是否正常
2. **性能问题**: 监控CPU和内存使用率
3. **网络问题**: 检查安全组和网络配置

## 📞 支持和维护

### 技术支持
- CloudBase官方文档
- 腾讯云技术支持
- 项目Issue反馈

### 维护计划
- 定期监控服务状态
- 及时更新依赖版本
- 备份重要配置

---

**最后更新**: 2025-12-14  
**部署状态**: ✅ 生产环境就绪  
**维护人员**: 项目开发团队